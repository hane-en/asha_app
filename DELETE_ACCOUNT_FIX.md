# ุญู ูุดููุฉ ุญุฐู ุงูุญุณุงุจ

## ๐ **ุงููุดููุฉ:**

ุนูุฏ ุงูุถุบุท ุนูู "ุญุฐู ุงูุญุณุงุจ":
1. โ ูุธูุฑ "ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู"
2. โ ูุง ูุชู ูุชุญ ุตูุญุฉ ุญุฐู ุงูุญุณุงุจ
3. โ ูุง ููุฌุฏ ููู `delete_account.php` ูู ุงูุฎุงุฏู

## ๐ **ุงูุฃุณุจุงุจ:**

### 1. **ุนุฏู ุญูุธ ูุนุฑู ุงููุณุชุฎุฏู:**
ูู `AuthService._saveUserData()` ูู ูุชู ุญูุธ `user_id` ุจุดูู ูููุตู ูู `SharedPreferences`.

### 2. **ุนุฏู ูุฌูุฏ ููู ุญุฐู ุงูุญุณุงุจ:**
ูู ููู ููุฌูุฏ ููู `asha_app_backend/api/auth/delete_account.php`.

### 3. **ูุดููุฉ ูู ุฏุงูุฉ `_getUserId()`:**
ุงูุฏุงูุฉ ุชุญุงูู ุงูุญุตูู ุนูู `user_id` ูู `SharedPreferences` ูููู ูู ูุชู ุญูุธู.

## โ **ุงูุญู:**

### 1. **ุฅุตูุงุญ ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู:**
```dart
Future<void> _saveUserData(
  Map<String, dynamic> userData,
  String token,
) async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setString('auth_token', token);
  await prefs.setString('user_data', jsonEncode(userData));
  // ุญูุธ ูุนุฑู ุงููุณุชุฎุฏู ุจุดูู ูููุตู ูููุตูู ุงูุณุฑูุน
  await prefs.setInt('user_id', userData['id']);
  await prefs.setString('user_name', userData['name'] ?? '');
  await prefs.setString('user_type', userData['user_type'] ?? 'user');
}
```

### 2. **ุฅูุดุงุก ููู ุญุฐู ุงูุญุณุงุจ:**
ุชู ุฅูุดุงุก `asha_app_backend/api/auth/delete_account.php` ูุน ุงููุธุงุฆู ุงูุชุงููุฉ:

- **ุงูุชุญูู ูู ุงููุณุชุฎุฏู**: ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุณุชุฎุฏู
- **ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ**: ุงูุชุฃูุฏ ูู ุตุญุฉ ูููุฉ ุงููุฑูุฑ
- **ุญุฐู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ**: ุญุฐู ุงูุฅุนูุงูุงุชุ ุงูุฎุฏูุงุชุ ุงูุญุฌูุฒุงุชุ ุงูุชููููุงุชุ ุงูููุถูุฉ
- **ุญุฐู ุงูุญุณุงุจ**: ุญุฐู ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงููุนุงููุงุช**: ุงุณุชุฎุฏุงู ุงููุนุงููุงุช ูุถูุงู ุณูุงูุฉ ุงูุจูุงูุงุช

### 3. **ุงูููุฏ ูู ุงูุฎุงุฏู:**
```php
<?php
// ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู
$user = $database->selectOne("SELECT * FROM users WHERE id = :id", ['id' => $userId]);

// ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
if (!password_verify($password, $user['password'])) {
    errorResponse('ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ', 401);
}

// ุจุฏุก ุงููุนุงููุฉ
$database->beginTransaction();

try {
    // ุญุฐู ุงูุฅุนูุงูุงุช ุงููุฑุชุจุทุฉ
    $database->delete('ads', 'provider_id = :provider_id', ['provider_id' => $userId]);
    
    // ุญุฐู ุงูุฎุฏูุงุช ุงููุฑุชุจุทุฉ
    $database->delete('services', 'provider_id = :provider_id', ['provider_id' => $userId]);
    
    // ุญุฐู ุงูุญุฌูุฒุงุช ุงููุฑุชุจุทุฉ
    $database->delete('bookings', 'user_id = :user_id', ['user_id' => $userId]);
    
    // ุญุฐู ุงูุชููููุงุช ุงููุฑุชุจุทุฉ
    $database->delete('reviews', 'user_id = :user_id', ['user_id' => $userId]);
    
    // ุญุฐู ุงูููุถูุฉ ุงููุฑุชุจุทุฉ
    $database->delete('favorites', 'user_id = :user_id', ['user_id' => $userId]);
    
    // ุญุฐู ุงููุณุชุฎุฏู ููุณู
    $result = $database->delete('users', 'id = :id', ['id' => $userId]);
    
    if ($result) {
        $database->commit();
        successResponse(null, 'ุชู ุญุฐู ุงูุญุณุงุจ ุจูุฌุงุญ');
    } else {
        $database->rollback();
        errorResponse('ูุดู ูู ุญุฐู ุงูุญุณุงุจ', 500);
    }
} catch (Exception $e) {
    $database->rollback();
    throw $e;
}
?>
```

## ๐ฏ **ุงููุชูุฌุฉ ุจุนุฏ ุงูุฅุตูุงุญ:**

1. โ **ุญูุธ ูุนุฑู ุงููุณุชุฎุฏู**: ูุชู ุญูุธ `user_id` ูู `SharedPreferences`
2. โ **ุฏุงูุฉ `_getUserId()`**: ุชุนูู ุจุดูู ุตุญูุญ
3. โ **ุตูุญุฉ ุญุฐู ุงูุญุณุงุจ**: ุชูุชุญ ุจุดูู ุตุญูุญ
4. โ **ุญุฐู ุงูุญุณุงุจ**: ูุนูู ูู ุงูุฎุงุฏู
5. โ **ุญุฐู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ**: ูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ

## ๐ **ุฎุทูุงุช ุญุฐู ุงูุญุณุงุจ:**

1. **ุงูุถุบุท ุนูู "ุญุฐู ุงูุญุณุงุจ"** ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
2. **ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ** ููุชุฃููุฏ
3. **ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ** ูู ุงูุฎุงุฏู
4. **ุญุฐู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ** (ุฅุนูุงูุงุชุ ุฎุฏูุงุชุ ุญุฌูุฒุงุชุ ุฅูุฎ)
5. **ุญุฐู ุงูุญุณุงุจ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
6. **ุญุฐู ุงูุจูุงูุงุช ุงููุญููุฉ** ูุงูุชูุงู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

## ๐ง **ุงููููุงุช ุงููุนุฏูุฉ:**

1. **`lib/services/auth_service.dart`**: ุฅุตูุงุญ ุญูุธ ูุนุฑู ุงููุณุชุฎุฏู
2. **`asha_app_backend/api/auth/delete_account.php`**: ุฅูุดุงุก ููู ุญุฐู ุงูุญุณุงุจ

---

**ุงูุขู ุณูุนูู ุญุฐู ุงูุญุณุงุจ ุจุดูู ุตุญูุญ!** ๐ 