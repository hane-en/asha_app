# اختبار قاعدة البيانات وجلب المزودين

## نظرة عامة

تم إنشاء أدوات شاملة لاختبار قاعدة البيانات وجلب المزودين من جدول المستخدمين. هذه الأدوات تساعد في:

1. **اختبار الاتصال بقاعدة البيانات**
2. **جلب المزودين من جدول المستخدمين**
3. **إضافة بيانات تجريبية**
4. **عرض إحصائيات قاعدة البيانات**

## الملفات المُنشأة

### 1. صفحة اختبار قاعدة البيانات
**الملف:** `lib/screens/database_test_page.dart`

**الميزات:**
- اختبار الاتصال بالخادم
- جلب المزودين من قاعدة البيانات
- عرض حالة الاتصال
- عرض قائمة المزودين مع تفاصيلهم

**الوصول:** من القائمة الجانبية → "اختبار قاعدة البيانات"

### 2. صفحة اختبار API
**الملف:** `lib/screens/test_api_page.dart`

**الميزات:**
- جلب المزودين عبر API
- عرض تفاصيل المزودين
- إمكانية التحديث

**الوصول:** من القائمة الجانبية → "اختبار التدفق" → "اختبار API"

### 3. ملف اختبار الاتصال
**الملف:** `asha_app_tag/api/test_connection.php`

**الميزات:**
- اختبار الاتصال بقاعدة البيانات
- عرض إحصائيات قاعدة البيانات
- عرض معلومات الخادم

### 4. ملف إضافة البيانات التجريبية
**الملف:** `asha_app_tag/insert_sample_data.php`

**الميزات:**
- إضافة 10 مزودين تجريبيين
- إضافة 6 فئات خدمات
- إضافة 20 خدمة تجريبية
- إضافة 3 مستخدمين عاديين
- إضافة 6 تقييمات تجريبية

## كيفية الاستخدام

### الخطوة 1: إعداد قاعدة البيانات

1. تأكد من تشغيل XAMPP/WAMP
2. تأكد من تشغيل Apache و MySQL
3. تأكد من وجود قاعدة البيانات `asha_app`

### الخطوة 2: إنشاء الجداول

قم بتشغيل ملف `asha_app_tag/database_complete_final.sql` لإنشاء جميع الجداول المطلوبة.

### الخطوة 3: إضافة البيانات التجريبية

يمكنك إضافة البيانات التجريبية بطريقتين:

#### الطريقة الأولى: عبر المتصفح
```
http://127.0.0.1/asha_app_tag/insert_sample_data.php
```

#### الطريقة الثانية: عبر ملف SQL
قم بتشغيل ملف `asha_app_tag/add_sample_providers.sql` في phpMyAdmin.

### الخطوة 4: اختبار الاتصال

1. افتح التطبيق
2. اذهب إلى القائمة الجانبية
3. اختر "اختبار قاعدة البيانات"
4. اضغط على "إعادة اختبار الاتصال"

## البيانات التجريبية المُضافة

### المزودين (10 مزودين)

| الاسم | البريد الإلكتروني | الهاتف | التقييم | عدد المراجعات | الحالة |
|-------|------------------|--------|---------|---------------|--------|
| أحمد محمد | ahmed@example.com | 0501234567 | 4.5 | 12 | موثق |
| فاطمة علي | fatima@example.com | 0502345678 | 4.8 | 25 | موثق |
| محمد حسن | mohammed@example.com | 0503456789 | 4.2 | 8 | موثق |
| سارة أحمد | sara@example.com | 0504567890 | 4.0 | 5 | غير موثق |
| علي محمود | ali@example.com | 0505678901 | 4.7 | 18 | موثق |
| نورا سعيد | nora@example.com | 0506789012 | 4.9 | 30 | موثق |
| خالد عبدالله | khalid@example.com | 0507890123 | 3.8 | 3 | غير موثق |
| ليلى محمد | layla@example.com | 0508901234 | 4.6 | 15 | موثق |
| عمر يوسف | omar@example.com | 0509012345 | 4.3 | 10 | موثق |
| رنا أحمد | rana@example.com | 0500123456 | 4.4 | 22 | موثق |

### الفئات (6 فئات)

1. **التصوير** - خدمات التصوير الاحترافي للمناسبات
2. **قاعات الأفراح** - قاعات احتفالات وأفراح
3. **الموسيقى** - خدمات الموسيقى والعزف
4. **التزيين** - خدمات تزيين المناسبات
5. **الحلويات** - حلويات ومخبوزات للمناسبات
6. **الأزياء** - أزياء وتأجير ملابس

### الخدمات (20 خدمة)

تم إضافة خدمات متنوعة لكل مزود، تشمل:
- تصوير احترافي وفيديو
- قاعات أفراح فاخرة وصغيرة
- عزف موسيقي ودجاجي
- تزيين قاعات ومناسبات
- حلويات عربية وغربية
- تأجير أزياء عروس وبدلات

## API Endpoints

### 1. اختبار الاتصال
```
GET /asha_app_tag/api/test_connection.php
```

**الاستجابة:**
```json
{
  "success": true,
  "message": "الاتصال بقاعدة البيانات يعمل بشكل صحيح",
  "data": {
    "database_status": "connected",
    "providers_count": 10,
    "users_count": 3,
    "services_count": 20,
    "categories_count": 6,
    "server_time": "2024-01-01 12:00:00",
    "php_version": "8.1.0"
  }
}
```

### 2. جلب جميع المزودين
```
GET /asha_app_tag/api/providers/get_all_providers.php
```

**المعاملات الاختيارية:**
- `category_id` - فلترة حسب الفئة
- `search` - البحث في الاسم أو البريد أو الهاتف
- `sort_by` - ترتيب حسب (rating, name, services, price, bookings, reviews, created)
- `sort_order` - ترتيب (ASC, DESC)
- `limit` - عدد النتائج (افتراضي: 50)
- `offset` - التخطي للصفحات

**الاستجابة:**
```json
{
  "success": true,
  "message": "تم جلب مزودي الخدمات بنجاح",
  "data": {
    "providers": [
      {
        "id": 1,
        "name": "أحمد محمد",
        "email": "ahmed@example.com",
        "phone": "0501234567",
        "rating": 4.5,
        "total_reviews": 12,
        "services_count": 2,
        "avg_service_rating": 4.55,
        "avg_price": 650.0,
        "total_bookings": 15,
        "is_verified": true,
        "categories": ["التصوير"],
        "price_range": {
          "min": 500.0,
          "max": 800.0,
          "avg": 650.0
        }
      }
    ],
    "total_providers": 10,
    "pagination": {
      "current_page": 1,
      "total_pages": 1,
      "has_next": false,
      "has_prev": false
    }
  }
}
```

## استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### 1. خطأ الاتصال بالخادم
**الأعراض:** رسالة "خطأ في الاتصال"
**الحلول:**
- تأكد من تشغيل XAMPP/WAMP
- تأكد من تشغيل Apache و MySQL
- تحقق من إعدادات `Config.apiBaseUrl`

#### 2. خطأ في قاعدة البيانات
**الأعراض:** رسالة "فشل في الاتصال بقاعدة البيانات"
**الحلول:**
- تأكد من وجود قاعدة البيانات `asha_app`
- تأكد من تشغيل MySQL
- تحقق من إعدادات الاتصال في `config/database.php`

#### 3. قاعدة البيانات فارغة
**الأعراض:** "لا يوجد مزودين"
**الحلول:**
- شغل ملف `insert_sample_data.php`
- أو شغل ملف `add_sample_providers.sql` في phpMyAdmin

#### 4. خطأ في API
**الأعراض:** رسالة خطأ من الخادم
**الحلول:**
- تحقق من سجلات الخطأ في Apache
- تأكد من صحة ملفات PHP
- تحقق من صلاحيات الملفات

## إحصائيات قاعدة البيانات

بعد إضافة البيانات التجريبية، ستجد:

- **10 مزودين** نشطين
- **3 مستخدمين** عاديين
- **20 خدمة** نشطة
- **6 فئات** خدمات
- **6 تقييمات** تجريبية

## ملاحظات مهمة

1. **كلمة المرور الافتراضية:** `password123` لجميع الحسابات التجريبية
2. **التوثيق:** بعض المزودين موثقين وبعضهم غير موثق للاختبار
3. **التقييمات:** تم إضافة تقييمات متنوعة لاختبار النظام
4. **الخدمات:** كل مزود لديه خدمات في فئات مختلفة

## التطوير المستقبلي

1. **إضافة فلترة متقدمة** للمزودين
2. **إضافة نظام البحث** المتقدم
3. **إضافة خرائط** لمواقع المزودين
4. **إضافة نظام التقييمات** التفاعلي
5. **إضافة نظام الحجز** المباشر 